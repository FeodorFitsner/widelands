#!/usr/bin/env python -tt
# encoding: utf-8
#

"""
Catches something like
blah (kjhdsfjh +

which should be 
blah
    (jdhsf + 
"""

def check_function(token_stripper, data):
    errors = []
    for lineno,line in enumerate(data.splitlines()):
        line = token_stripper.strip_macros(token_stripper.strip_strings(token_stripper.strip_comments(line)).strip())
        lineno += 1
        opening_parens = line.count('(')
        closing_parens = line.count(')')
        if opening_parens > closing_parens and line.strip()[0] != '(':
            errors.append( (lineno,
                "Parenthesis not closed before end of "
                "line must be at line begin")
            )

    return errors

is_multiline = True
strip_strings = True
strip_comments = True

evaluate_matches = check_function

allowed = [
"""float g(float, float) {
\treturn
\t\t(0.0 +
\t\t g(1.1, 2.2));
}""",

"""\tstd::string newvisi = s->get_string("newvisi", "");""",

# Ignore macros
"""#if (defined(WIN32) || defined (WINDOWS) || \\
\tdefined (_WINDOWS)) && defined(CALLBACK) && \\
\tdefined (USEWINDOWS_CALLBACK)""",
]

forbidden = [
"""float g(float, float) {
\treturn (0.0 +
\t\tg(1.1, 2.2));
}""",
]


